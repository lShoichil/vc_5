# Пятое задание по Вездекоду 2022

Текст задания:

Сделайте дашборд голосования — статистику, в которой вы сможете в реальном времени следить за тем, как выставляются лайки и меняется топ самых популярных мемов. 
Как позаботиться о том, чтобы доступ к статистике был только у нужных пользователей? ;)

Решение:

Я сортирую не при каждому изменении, а только при каждому выводе, потому что может быть слишком много пользователей и тогда система упадёт под нагрузкой.
Система авторизации реализована с помощью JWT. (Во всех роутах где есть @token_required, будет запрошен токен)

Прикладываю дополнительно **свои файлы из постмана** чтобы было удобнее тестить.

Далее будет подробнее о самих роутах пользователей. Роуты для мемов перенёс из [проекта с 1-4 заданиями](https://github.com/lShoichil/everywhere_code_2022):

## Необходимо выполнить перед запуском
- Создать config.py в разделе Memes с написать следующий код:
```
import os

file_path = os.path.abspath(os.getcwd()) + "/mems.db"
SECRET_KEY = '...'
SQLALCHEMY_DATABASE_URI = 'sqlite:///' + file_path
SQLALCHEMY_TRACK_MODIFICATIONS = True
access_token = '...'

```
Этот файл содержит секретный ключ и ТОКЕН, поэтому я не стал его выкладывать. Свой секретный ключ токен нужно ввести вместо '...'
- Создать виртуальное окружение:

Установить библиотеку virtualenv для python командой:
```
pip install virtualenv 
```
Создать окружение командой:
```
py -m venv venv  
```
Зайти в него командой (для windows):
```
.\venv\Scripts\activate
```
- Импортировать зависимость с помощью requirements.txt командой:
```
pip install -r .\requirements.txt
```

## Запуск
- Необходимо прописть команду:
```
 py .\run.py  
```
Может возникнуть ошибка в библиотеке vk:
```
ImportError: cannot import name 'Iterable' from 'collections'
```
[Решение](https://stackoverflow.com/questions/35762077/creating-a-new-object-returns-attributeerror-list-object-has-no-attribute-s)


## Клиент
- Решил добавить консольный клиент. Обращаю внимание что в него зайти нужно будет из под venv иначе потеряются некоторые библиотеки.

- ВАЖНО: Нужно создать сначала пользователя в бд, иначе клиент упадёт. Логин и пароль клиента меняются внутри client/main.py.

## Работа с пользователями
### Авторизация пользователя
Токен авторизованного пользователя действителей 1 час

В случае неверного токена авторизованного пользователя
![image](https://user-images.githubusercontent.com/78679833/149453545-ba5db68d-dcc1-4844-a2e5-eb55125e1c8f.png)
В случае отсутствия токена авторизованного пользователя
![image](https://user-images.githubusercontent.com/78679833/149453568-03f4057c-dd72-4410-aba0-b326186b0c4d.png)
Получение верного токена
![image](https://user-images.githubusercontent.com/78679833/149453607-79975d85-6e36-41f8-bf2a-84ebfc6cd023.png)
В случае запроса токена для не существующего пользователя
![image](https://user-images.githubusercontent.com/78679833/149453687-33674fd4-6771-4a2b-b711-afd40be44883.png)
### Создание пользователя
![image](https://user-images.githubusercontent.com/78679833/174469890-a73fa08f-aba1-4728-bec3-6effb8d0268e.png)
### Вывод всех пользователей
![image](https://user-images.githubusercontent.com/78679833/174469882-603a5f91-0207-4c9c-b763-82b97558fd31.png)
### Повышение прав пользователя
![image](https://user-images.githubusercontent.com/78679833/174469876-36b60dd4-68fe-48d9-b3fe-a740121ea712.png)
### Удаление пользователя
![image](https://user-images.githubusercontent.com/78679833/174469864-d8a3c7d0-85af-4431-b102-a73f34a0bab7.png)

